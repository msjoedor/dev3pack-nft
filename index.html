<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dev3Pack NFT - The Coolest Bootcamp Project</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4ade80;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 16px;
        }
        
        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .btn {
            background: linear-gradient(45deg, #4ade80, #22c55e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 222, 128, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, #8b5cf6, #7c3aed);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .status.success {
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid #4ade80;
        }
        
        .status.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }
        
        .status.info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
        }
        
        .nft-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .nft-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nft-id {
            font-size: 1.5rem;
            font-weight: bold;
            color: #4ade80;
            margin-bottom: 10px;
        }
        
        .nft-uri {
            word-break: break-all;
            opacity: 0.8;
            font-size: 0.9rem;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Dev3Pack NFT</h1>
            <p>Built with Foundry by msjoedor</p>
            <button class="btn" onclick="connectWallet()" id="connectBtn" style="margin-top: 20px;">Connect MetaMask</button>
        </div>
        
        <div id="status" class="status hidden"></div>
        
        <div class="card">
            <h2>üìä Contract Statistics</h2>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalSupply">-</div>
                    <div class="stat-label">Total Supply</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="maxSupply">-</div>
                    <div class="stat-label">Max Supply</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="mintPrice">-</div>
                    <div class="stat-label">Mint Price (ETH)</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="mintingActive">-</div>
                    <div class="stat-label">Minting Active</div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>üé® Mint NFT</h2>
            <div class="form-group">
                <label for="tokenURI">Token URI (Metadata URL):</label>
                <input type="text" id="tokenURI" placeholder="https://dev3pack.com/nft/1" />
            </div>
            <button class="btn" onclick="mintNFT()">Mint NFT</button>
            <button class="btn btn-secondary" onclick="loadStats()">Refresh Stats</button>
        </div>
        
        <div class="card">
            <h2>üë§ My NFTs</h2>
            <div id="nftList" class="nft-list">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading your NFTs...</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>‚öôÔ∏è Owner Functions</h2>
            <button class="btn btn-secondary" onclick="toggleMinting()">Toggle Minting</button>
            <button class="btn btn-secondary" onclick="withdraw()">Withdraw Funds</button>
        </div>
    </div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = "0xdF0d3C25F41507c2d5528B6ad59067Cc2f716907"; // Sepolia deployed address
        const CONTRACT_ABI = [
            "function mintNFT(string memory _tokenURI) external payable",
            "function getStats() external view returns (uint256, uint256, uint256, bool)",
            "function toggleMinting() external",
            "function withdraw() external",
            "function owner() external view returns (address)",
            "function maxSupply() external view returns (uint256)",
            "function mintPrice() external view returns (uint256)",
            "function mintingActive() external view returns (bool)"
        ];
        
        let provider, signer, contract;
        
        async function init() {
            if (typeof window.ethereum !== 'undefined') {
                // Check if already connected
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        await connectToWallet();
                    } else {
                        showStatus("Click 'Connect MetaMask' to get started!", "info");
                    }
                } catch (error) {
                    console.error("Error checking MetaMask connection:", error);
                    showStatus("Click 'Connect MetaMask' to get started!", "info");
                }
            } else {
                showStatus("Please install MetaMask to use this dApp!", "error");
            }
        }
        
        async function connectToWallet() {
            try {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                showStatus("Connected to MetaMask!", "success");
                document.getElementById('connectBtn').style.display = 'none';
                await loadStats();
                await loadUserNFTs();
            } catch (error) {
                console.error("Error connecting to wallet:", error);
                showStatus("Error connecting to wallet: " + error.message, "error");
            }
        }
        
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    await connectToWallet();
                } catch (error) {
                    console.error("Error connecting to MetaMask:", error);
                    showStatus("Please connect MetaMask and try again!", "error");
                }
            } else {
                showStatus("Please install MetaMask to use this dApp!", "error");
            }
        }
        
        async function loadStats() {
            try {
                const [totalSupply, maxSupply, mintPrice, mintingActive] = await contract.getStats();
                
                document.getElementById('totalSupply').textContent = totalSupply.toString();
                document.getElementById('maxSupply').textContent = maxSupply.toString();
                document.getElementById('mintPrice').textContent = ethers.utils.formatEther(mintPrice);
                document.getElementById('mintingActive').textContent = mintingActive ? "Yes" : "No";
            } catch (error) {
                console.error("Error loading stats:", error);
                showStatus("Error loading contract stats", "error");
            }
        }
        
        async function mintNFT() {
            const tokenURI = document.getElementById('tokenURI').value;
            if (!tokenURI) {
                showStatus("Please enter a token URI", "error");
                return;
            }
            
            try {
                showStatus("Minting NFT...", "info");
                const mintPrice = await contract.mintPrice();
                const tx = await contract.mintNFT(tokenURI, { value: mintPrice });
                showStatus("Transaction sent! Waiting for confirmation...", "info");
                
                await tx.wait();
                showStatus("NFT minted successfully!", "success");
                
                document.getElementById('tokenURI').value = '';
                await loadStats();
                await loadUserNFTs();
            } catch (error) {
                console.error("Error minting NFT:", error);
                showStatus("Error minting NFT: " + error.message, "error");
            }
        }
        
        async function loadUserNFTs() {
            try {
                const nftList = document.getElementById('nftList');
                nftList.innerHTML = '<p>SimpleNFT deployed! Mint your first NFT to see it here.</p>';
            } catch (error) {
                console.error("Error loading user NFTs:", error);
                showStatus("Error loading your NFTs", "error");
            }
        }
        
        async function toggleMinting() {
            try {
                const tx = await contract.toggleMinting();
                await tx.wait();
                showStatus("Minting status toggled!", "success");
                await loadStats();
            } catch (error) {
                console.error("Error toggling minting:", error);
                showStatus("Error toggling minting: " + error.message, "error");
            }
        }
        
        async function withdraw() {
            try {
                const tx = await contract.withdraw();
                await tx.wait();
                showStatus("Funds withdrawn successfully!", "success");
                await loadStats();
            } catch (error) {
                console.error("Error withdrawing funds:", error);
                showStatus("Error withdrawing funds: " + error.message, "error");
            }
        }
        
        function showStatus(message, type) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.classList.remove('hidden');
            
            setTimeout(() => {
                status.classList.add('hidden');
            }, 5000);
        }
        
        // Initialize when page loads
        // Wait for ethers to load with timeout
        let ethersLoadAttempts = 0;
        const maxAttempts = 50; // 5 seconds max wait
        
        function waitForEthers() {
            ethersLoadAttempts++;
            if (typeof ethers !== 'undefined') {
                console.log("Ethers.js loaded successfully!");
                init();
            } else if (ethersLoadAttempts < maxAttempts) {
                setTimeout(waitForEthers, 100);
            } else {
                console.error("Ethers.js failed to load after 5 seconds");
                showStatus("Error: ethers.js library failed to load. Please refresh the page.", "error");
                // Try alternative CDN as fallback
                loadEthersFallback();
            }
        }
        
        function loadEthersFallback() {
            console.log("Trying fallback CDN...");
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js';
            script.onload = function() {
                console.log("Fallback ethers.js loaded!");
                init();
            };
            script.onerror = function() {
                showStatus("Error: Unable to load ethers.js from any CDN. Please check your internet connection.", "error");
            };
            document.head.appendChild(script);
        }
        
        window.addEventListener('load', waitForEthers);
        
        // Handle script loading errors
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'SCRIPT' && e.target.src.includes('ethers')) {
                console.error("Ethers.js script failed to load:", e.target.src);
                showStatus("Error loading ethers.js library. Trying fallback...", "error");
                loadEthersFallback();
            }
        });
    </script>
</body>
</html>
